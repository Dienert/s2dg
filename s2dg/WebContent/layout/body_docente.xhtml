<?xml version="1.0" encoding="UTF-8"?>

<rich:panel xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:a4j="http://richfaces.org/a4j"
	style="margin:0;border-width:0;padding:0px;">

	<a4j:loadBundle basename="messages" var="msg" />

	<table width="100%">
		<tr>
			<td width="200px">
			<div class="menu_disciplinas">
			<center><h:outputText styleClass="menu_disciplinas_titulo"
				value="Disciplinas Ministradas" /></center>
			<div class="menu_disciplinas_lista"><h:form>
				<ui:repeat value="#{disciplinasMinistradasBean.turmasPorDisciplina}"
					var="disciplinaTurmas">
					<h:outputText value="#{disciplinaTurmas.disciplina.nome}" />
					<br />
					<ui:repeat value="#{disciplinaTurmas.turmas}" var="turma">
						<a4j:commandLink styleClass="menu_disciplina_turma"
							action="#{fachada.setTurmaAtual(turma)}"
							value=":: Turma #{turma.numero}"
							reRender="titulo_disciplina_doc,titulo_turma_doc,tabela_avaliacoes,checkboxmedia,editorPlano, criar_avaliacao" />
						<br />
					</ui:repeat>
				</ui:repeat>
			</h:form></div>
			</div>
			<br></br>
			<rich:calendar popup="false" locale="pt_BR" showFooter="false">
			</rich:calendar></td>
			<td style="padding-left: 20px;" height="100%">
				<h:outputText styleClass="body_titulo_disciplina" id="titulo_disciplina_doc"
					value="Disciplina: #{turmaBean.turma.disciplina.codigo} - #{turmaBean.turma.disciplina.nome}" />
				<br />
				<h:outputText value="Turma #{turmaBean.turma.numero}" id="titulo_turma_doc" />
				<br />
				<br />
			<div>
			<rich:tabPanel switchType="client">
				<rich:tab label="Avaliaç&#245;es">
					<rich:panel styleClass="border_zero">
						<h:form>
							<rich:panel styleClass="border_zero" id="tabela_avaliacoes">
								<rich:dataTable var="alunoTurma" value="#{fachada.alunoTurmas}" style="text-align: center;" >
									<rich:column styleClass="matricula">
										<f:facet name="header">Matrícula</f:facet>
										<h:outputText value="#{alunoTurma.aluno.matricula}" />
									</rich:column>
									<rich:column styleClass="aluno">
										<f:facet name="header">Aluno</f:facet>
										<h:outputText value="#{alunoTurma.aluno.usuario.nome}" />
									</rich:column>
									<rich:column styleClass="faltas">
										<f:facet name="header">Faltas</f:facet>
										<h:inputText value="#{alunoTurma.faltas}" size="5" />
									</rich:column>
									<rich:columns  value="#{fachada.avaliacoesDaTurma}" var="avaliacao">
										<f:facet name="header">
											<h:panelGroup>
												<h:outputText value="#{avaliacao.nome}" />
												<a4j:commandLink id="excluir#{avaliacao.id}"
													action="#{fachada.setAvaliacaoParaExclusao(avaliacao)}"
													oncomplete="Richfaces.showModalPanel('myModalPanel',{width:485, top:200});"
													reRender="myModalDiv" >
													<img alt="remover" src="img/del.png" />
												</a4j:commandLink>
												<br/>
												<h:outputText value="peso: #{avaliacao.peso}" />
												<a4j:commandLink action="#{fachada.setAvaliacaoParaEdicao(avaliacao)}" reRender="criar_avaliacao">
													<img alt="editar" src="img/edit.png" />
												</a4j:commandLink>
											</h:panelGroup>
										</f:facet>
										<h:inputText value="#{fachada.getAlunoTurmaAvaliacao(alunoTurma, avaliacao).nota}" size="5"/>
									</rich:columns>
									<rich:column styleClass="media">
										<f:facet name="header">Média Final</f:facet>
										<h:inputText value="#{alunoTurma.media}" rendered="#{not turmaBean.turma.calcularMediaAutomaticamente}" size="5"/>
										<h:outputText value="#{alunoTurma.media}" rendered="#{turmaBean.turma.calcularMediaAutomaticamente}">
											<f:convertNumber maxFractionDigits="2" minFractionDigits="2" locale="pt_BR" />
										</h:outputText>
									</rich:column>
								</rich:dataTable>								
							</rich:panel>
								<h:selectBooleanCheckbox id="checkboxmedia" value="#{turmaBean.turma.calcularMediaAutomaticamente}">
									<a4j:support event="onmouseup" action="#{fachada.switchCalcMediaAuto}" reRender="tabela_avaliacoes, checkboxmedia" limitToList="true" />
								</h:selectBooleanCheckbox>
							<h:outputText for="checkboxmedia"
								value="Calcular Média Automaticamente" />
							<a4j:commandButton styleClass="botao_salvar" type="submit"
								value="Salvar" action="#{fachada.persisteAlunoTurmas}"
								reRender="tabela_avaliacoes" />
						</h:form>
						<br />
						<br />
						<br />
						<h:form>
							<rich:panel id="criar_avaliacao" style="width: 260px;">
								<f:facet name="header">
									<h:outputText value="#{fachada.criarOuEditar?'Criar':'Editar'} Avaliação" />
								</f:facet>
								<table>
									<tr>
										<td><h:outputText value="Nome: " /></td>
										<td><h:inputText value="#{fachada.avaliacao.nome}" /></td>
										<td><a4j:commandButton type="submit"
											rendered="#{not fachada.criarOuEditar}"
											reRender="criar_avaliacao, tabela_avaliacoes" value="Atualizar"
											action="#{fachada.atualizarAvaliacao}" /></td>
									</tr>
									<tr>
										<td><h:outputText value="Peso:" /></td>
										<td><rich:inputNumberSpinner minValue="1" cycled="false"
											value="#{fachada.avaliacao.peso}" /></td>
										<td><a4j:commandButton styleClass="botao_criar"
											type="submit" rendered="#{fachada.criarOuEditar}"
											value="Criar" action="#{fachada.criarAvaliacao}"
											reRender="tabela_avaliacoes, criar_avaliacao, checkboxmedia" />
											<a4j:commandButton rendered="#{not fachada.criarOuEditar}"
											value="Cancelar" action="#{fachada.cancelarEdicao}"
											reRender="criar_avaliacao" /></td>
									</tr>
								</table>
							</rich:panel>
						</h:form>
					</rich:panel>
				<h:messages />	
				</rich:tab>
				<rich:tab label="Cronograma de Aulas">
					<ui:include src="/calendario.xhtml" />
				</rich:tab>
				<rich:tab label="Plano de Curso">
					<h:form>
						<center>
						<rich:editor useSeamText="true" id="editorPlano"
							value="#{turmaBean.turma.planoDeCurso}" width="659" height="282" theme="advanced"
							plugins="save,paste" language="pt" /> <a4j:commandButton
							type="submit" value="Salvar"
							action="#{fachada.persistePlanoDeCurso}" style="FONT-WEIGHT: bold; width : 85px; height : 29px;"/>
							</center>
					</h:form>
				</rich:tab>
			</rich:tabPanel></div>
			</td>
		</tr>
	</table>
	<rich:modalPanel id="myModalPanel" autosized="true" zindex="2000" moveable="false">
		<f:facet name="header">
			<h:panelGroup>
				<h:outputText value="Atenção!" />
			</h:panelGroup>
		</f:facet>
		<center>
		<s:div id="myModalDiv">
		<h:outputText
			value="Tem certeza que deseja excluir a avaliação '#{fachada.avaliacaoParaExclusao.nome}' e todas as suas notas?" />
		</s:div>
		<br />
		<h:form>
			<a4j:commandButton id="botaosim" action="#{fachada.excluiAvaliacao}" limitToList="true"
				value="Sim" reRender="tabela_avaliacoes">
				<rich:componentControl for="myModalPanel" attachTo="botaosim"
					operation="hide" event="onclick" />
			</a4j:commandButton>
			<a4j:commandButton id="botaonao" action="#{fachada.cancelaExclusao}"
				value="Não">
				<rich:componentControl for="myModalPanel" attachTo="botaonao"
					operation="hide" event="onclick" />
			</a4j:commandButton>
		</h:form></center>
	</rich:modalPanel>
</rich:panel>