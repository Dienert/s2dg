<?xml version="1.0" encoding="UTF-8"?>

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:s="http://jboss.com/products/seam/taglib"
	template="/layout/template.xhtml">

	<ui:define name="body">
	<rich:panel>
	<f:facet name="header">Efetuar Matrícula</f:facet>
	<center>
	<h:form>
	<h:outputText id="matricula_msg" value="#{matriculaBean.msg}"
		style="float: left; color: red;" />
	<br/>
	<rich:dataTable value="#{matriculaBean.turmasAptasPorDisciplina}" var="disciplinaTurmas"
		id="turmas_aptas" style="text-align: center" >
		<f:facet name="header">Turmas Aptas</f:facet>
		<rich:column sortOrder="ASCENDING"
			sortBy="#{disciplinaTurmas.disciplina.nome}">
			<f:facet name="header">Disciplina</f:facet>
			<h:outputText value="#{disciplinaTurmas.disciplina.nome}" />
		</rich:column>
		<rich:column sortBy="#{disciplinaTurmas.disciplina.creditos}">
			<f:facet name="header">Créditos</f:facet>
			<h:outputText value="#{disciplinaTurmas.disciplina.creditos}" />
		</rich:column>
		<rich:column>
			<f:facet name="header">Turma</f:facet>
			<a4j:repeat value="#{disciplinaTurmas.listaTurmasSemUltima()}" var="turma">
				<h:outputText value="#{turma.numero}" />
				<hr/>
			</a4j:repeat>
			<h:outputText value="#{disciplinaTurmas.ultimaTurma.numero}" />
		</rich:column>
		<rich:column>
			<f:facet name="header">Professor(es)</f:facet>
			<a4j:repeat value="#{disciplinaTurmas.listaTurmasSemUltima()}" var="turma">
				<rich:dataList value="#{matriculaBean.listaProfessores(turma)}" var="professor">
					<h:outputText value="#{professor.usuario.nome}" />
				</rich:dataList>
				<hr/>
			</a4j:repeat>
			<rich:dataList value="#{matriculaBean.listaProfessores(disciplinaTurmas.ultimaTurma)}" var="professor">
				<h:outputText value="#{professor.usuario.nome}" />
			</rich:dataList>
		</rich:column>
		<rich:column>
			<f:facet name="header">Horário</f:facet>
			<a4j:repeat value="#{disciplinaTurmas.listaTurmasSemUltima()}" var="turma">
				<rich:dataList value="#{matriculaBean.getHorariosOrdenados(turma.horarios)}" var="horario">
					<h:outputText value="#{horario.toString()}" />
				</rich:dataList>
				<hr/>
			</a4j:repeat>
			<rich:dataList value="#{matriculaBean.getHorariosOrdenados(disciplinaTurmas.ultimaTurma.horarios)}" var="horario">
				<h:outputText value="#{horario.toString()}" />
			</rich:dataList>
		</rich:column>
		<rich:column>
			<f:facet name="header">Vagas</f:facet>
			<a4j:repeat value="#{disciplinaTurmas.listaTurmasSemUltima()}" var="turma">
				<h:outputText value="#{matriculaBean.getOferta(turma).numeroDeVagasDisponiveis}/#{matriculaBean.getOferta(turma).numeroDeVagasOfertadas}" />
				<hr/>
			</a4j:repeat>
			<h:outputText value="#{matriculaBean.getOferta(disciplinaTurmas.ultimaTurma).numeroDeVagasDisponiveis}/#{matriculaBean.getOferta(disciplinaTurmas.ultimaTurma).numeroDeVagasOfertadas}" />
		</rich:column>
		<rich:column>
			<a4j:repeat value="#{disciplinaTurmas.listaTurmasSemUltima()}" var="turma">
				<a4j:commandButton action="#{matriculaBean.selecionaTurma(turma)}" value="Selecionar"
					rendered="#{matriculaBean.getOferta(turma).numeroDeVagasDisponiveis > 0}"
					reRender="turmas_selecionadas, turmas_aptas" ajaxSingle="true" />
				<h:outputText value="Não há mais vagas disponíveis" style="color: red;"
					rendered="#{matriculaBean.getOferta(turma).numeroDeVagasDisponiveis == 0}"/>
				<hr/>
			</a4j:repeat>
			<a4j:commandButton action="#{matriculaBean.selecionaTurma(disciplinaTurmas.ultimaTurma)}" value="Selecionar"
				rendered="#{matriculaBean.getOferta(disciplinaTurmas.ultimaTurma).numeroDeVagasDisponiveis > 0}"
				reRender="turmas_selecionadas, turmas_aptas" ajaxSingle="true" />
			<h:outputText value="Não há mais vagas disponíveis" style="color: red;"
				rendered="#{matriculaBean.getOferta(disciplinaTurmas.ultimaTurma).numeroDeVagasDisponiveis == 0}"/>
		</rich:column>
		</rich:dataTable>
	<br/>
	<br/>
	<rich:dataTable value="#{matriculaBean.turmasSelecionadas}" var="turma" id="turmas_selecionadas"
		style="text-align: center" >
		<f:facet name="header">Turmas Selecionadas</f:facet>
		<rich:column sortOrder="ASCENDING" sortBy="#{turma.disciplina.nome}">
			<f:facet name="header">Disciplina</f:facet>
			<h:outputText value="#{turma.disciplina.nome}" />
		</rich:column>
		<rich:column sortBy="#{turma.disciplina.creditos}">
			<f:facet name="header">Créditos</f:facet>
			<h:outputText value="#{turma.disciplina.creditos}" />
		</rich:column>
		<rich:column sortBy="#{turma.numero}">
			<f:facet name="header">Turma</f:facet>
			<h:outputText value="#{turma.numero}" />
		</rich:column>
		<rich:column sortBy="#{matriculaBean.listaProfessores(turma).get(0).usuario.nome}">
			<f:facet name="header">Professor(es)</f:facet>
			<rich:dataList value="#{matriculaBean.listaProfessores(turma)}" var="professor">
				<h:outputText value="#{professor.usuario.nome}" />
			</rich:dataList>
		</rich:column>
		<rich:column sortBy="#{matriculaBean.getHorariosOrdenados(turma.horarios).get(0).dia}">
			<f:facet name="header">Horário</f:facet>
			<rich:dataList value="#{matriculaBean.getHorariosOrdenados(turma.horarios)}" var="horario">
				<h:outputText value="#{horario.toString()}" />
			</rich:dataList>
		</rich:column>
		<rich:column sortBy="#{matriculaBean.getOferta(turma).numeroDeVagasDisponiveis}">
			<f:facet name="header">Vagas</f:facet>
			<h:outputText value="#{matriculaBean.getOferta(turma).numeroDeVagasDisponiveis}/#{matriculaBean.getOferta(turma).numeroDeVagasOfertadas}" />
		</rich:column>
		<rich:column>
			<a4j:commandButton action="#{matriculaBean.deselecionaTurma(turma)}"
				value="Remover" reRender="turmas_selecionadas, turmas_aptas" ajaxSingle="true" />
		</rich:column>
	</rich:dataTable>
	<br/>
	<a4j:commandButton styleClass="botao_salvar" action="#{matriculaBean.fazMatricula()}"
		value="Matricular" ajaxSingle="true" limitToList="true" reRender="matricula_msg, turmas_selecionadas" />
	<h:commandButton styleClass="botao_salvar" action="home" value="Cancelar" />
	<br/>
	<br/>
	</h:form>
	</center>
	</rich:panel>
	</ui:define>

</ui:composition>