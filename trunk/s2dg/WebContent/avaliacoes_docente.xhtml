<?xml version="1.0" encoding="UTF-8"?>

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:s="http://jboss.com/products/seam/taglib">

	<rich:panel styleClass="border_zero">
		<h:form>
			<rich:panel styleClass="border_zero" id="tabela_avaliacoes">
				<rich:dataTable var="alunoTurma"
					value="#{alunoTurmasBean.alunoTurmas}" style="text-align: center;">
					<rich:column styleClass="matricula" sortBy="#{alunoTurma.aluno.matricula}">
						<f:facet name="header">Matrícula</f:facet>
						<h:outputText value="#{alunoTurma.aluno.matricula}" />
					</rich:column>
					<rich:column styleClass="aluno" sortOrder="ASCENDING" sortBy="#{alunoTurma.aluno.usuario.nome}">
						<f:facet name="header">Aluno</f:facet>
						<h:outputText value="#{alunoTurma.aluno.usuario.nome}" />
					</rich:column>
					<rich:column styleClass="faltas" sortBy="#{alunoTurma.faltas}">
						<f:facet name="header">Faltas</f:facet>
						<h:inputText value="#{alunoTurma.faltas}" size="5" />
					</rich:column>
					<rich:columns value="#{avaliacoesBean.avaliacoes}" var="avaliacao" >
						<f:facet name="header">
							<h:panelGroup>
								<h:outputText value="#{avaliacao.geraNomeTruncado()}" />
								<a4j:commandLink id="excluir#{avaliacao.id}"
									action="#{avaliacaoBean.setAvaliacaoParaExclusao(avaliacao)}"
									oncomplete="Richfaces.showModalPanel('myModalPanel',{width:485, top:200});"
									reRender="myModalDiv">
									<img alt="remover" src="img/del.png" />
								</a4j:commandLink>
								<br />
								<h:outputText value="peso: #{avaliacao.peso}" />
								<a4j:commandLink
									action="#{avaliacaoBean.setAvaliacaoParaEdicao(avaliacao)}"
									reRender="criar_avaliacao">
									<img alt="editar" src="img/edit.png" />
								</a4j:commandLink>
							</h:panelGroup>
						</f:facet>
						<h:inputText value="#{alunoTurmaAvaliacoesBean.getAlunoTurmaAvaliacao(alunoTurma, avaliacao).nota}"
							size="5" converter="#{notaConverter}" >
						</h:inputText>
					</rich:columns>
					<rich:column styleClass="media" sortBy="#{alunoTurma.media}">
						<f:facet name="header">Média Final</f:facet>
						<h:inputText value="#{alunoTurma.media}" converter="#{notaConverter}"
							rendered="#{not turmaBean.turma.calcularMediaAutomaticamente}"
							size="5" >
						</h:inputText>
						<h:outputText value="#{alunoTurma.media}"
							rendered="#{turmaBean.turma.calcularMediaAutomaticamente}">
							<f:convertNumber maxFractionDigits="2" minFractionDigits="2"
								locale="pt_BR" />
						</h:outputText>
					</rich:column>
				</rich:dataTable>
			</rich:panel>
			<h:selectBooleanCheckbox id="checkboxmedia"
				value="#{turmaBean.turma.calcularMediaAutomaticamente}">
				<a4j:support event="onmouseup"
					action="#{turmaBean.switchCalcMediaAuto}"
					reRender="tabela_avaliacoes, checkboxmedia" limitToList="true" />
			</h:selectBooleanCheckbox>
			<h:outputText for="checkboxmedia"
				value="Calcular Média Automaticamente" />
			<a4j:commandButton styleClass="botao_salvar" type="submit"
				value="Salvar"
				action="#{alunoTurmasBean.atualizaAlunoTurmas}"
				reRender="tabela_avaliacoes" />
		</h:form>
		<br />
		<br />
		<br />
		<h:panelGrid columns="2">
			<ui:include src="/criar_editar_avaliacao.xhtml" />
			<ui:include src="/dica_avaliacoes.xhtml" />
		</h:panelGrid>
	</rich:panel>

</ui:composition>